<div ng-controller="PropertiespanelController as propertiespanel" class="full-height side-panel">

    <div class="title">Properties</div>

    <div ng-hide="propertiespanel.block" class="properties">
        <p class="text-center">Select a <strong>single</strong> block to change its properties.</p>
        <p class="text-center"><em>NOTE: The root node represents a tree. Therefore, changes applied to this node will
                persist on the tree object.</em></p>
    </div>

    <div ng-show="propertiespanel.block" class="properties">
        <form>
            <div class="form-group">
                <div class="form-group" ng-if="propertiespanel.original.category == 'root'">
                    <button id="ButtonSave" type="button" ng-click="propertiespanel.RunBt()">RUN BT</button>
                </div>
            </div>

            <div class="form-group">
                <label for="title" ng-if="propertiespanel.original.category == 'root'">Intent</label>
                <div class="property-title-container" ng-if="propertiespanel.original.category != 'root'">
                    <label for="title">Title</label>
                    <a
                        ng-if="propertiespanel.block.title != 'Explanation Method' && propertiespanel.original.name == 'Explanation Method'">
                        <i class="fa fa-info-circle" ng-disabled="item.fixed" ng-model="item.key" readonly="readonly"
                            ng-mouseenter="propertiespanel.startTimeout(propertiespanel.block.title,'title')"
                            ng-mouseleave="propertiespanel.cancelTimeout(propertiespanel.block.title,'title')">
                        </i>
                    </a>
                </div>
                <div id="header" ng-if="propertiespanel.TitleName">
                    <ul class="nav">
                        <li ng-if="propertiespanel.original.category != 'root'"><a
                                ng-model="propertiespanel.block.title">{{propertiespanel.block.title}}</a>
                            <ul>
                                <li ng-if="propertiespanel.original.name == 'Explanation Method'"
                                    ng-repeat="option in propertiespanel.Explainers"
                                    ng-click="propertiespanel.UpdateProperties(option,propertiespanel.block,propertiespanel.original.id)"
                                    ng-disabled="item.fixed"
                                    ng-mouseenter="propertiespanel.startTimeout(option,'Explanation')"
                                    ng-mouseleave="propertiespanel.cancelTimeout(option,'Explanation')">
                                    <a>{{option}}</a>
                                </li>
                            </ul>
                        </li>
                        <li ng-if="propertiespanel.original.category == 'root'"
                            ng-click="propertiespanel.UpdateProperties(option,propertiespanel.block,propertiespanel.original.id)">
                            <a ng-model="propertiespanel.block.title"
                                ng-click="propertiespanel.renameIntends(propertiespanel.block.title)">{{propertiespanel.block.title}}
                            </a>
                        </li>
                    </ul>
                </div>

                <input ng-if="!propertiespanel.TitleName" type="text" class="form-control" name="title"
                    placeholder="Title" ng-keydown="propertiespanel.keydown($event)"
                    ng-model="propertiespanel.block.title" ng-change="propertiespanel.update()">
            </div>

            <div class="form-group" ng-if="propertiespanel.original.name == 'Condition'">
                <div id="header">
                    <ul class="nav">
                        <li>
                            <a ng-model="propertiespanel.DataType">{{propertiespanel.block.DataType}}</a>
                            <ul>
                                <li ng-repeat="data in propertiespanel.TypeOfData"
                                    ng-click="propertiespanel.SelectTypeOfData(data)">
                                    <a>{{data}}</a>
                                </li>
                            </ul>
                        </li>

                    </ul>
                </div>
            </div>

            <div class="form-group" ng-if="propertiespanel.original.name == 'Condition'">
                <label for="title">Variable Name</label>
                <input type="text" placeholder="Varible Name" class="form-control" name="title"
                    ng-keydown="propertiespanel.keydown($event)" ng-model="propertiespanel.block.VariableName"
                    ng-change="propertiespanel.update()">
            </div>

            <div class="form-group" ng-show="propertiespanel.original.category == 'root'">
                <b3-key-table heading="Properties" ng-model="propertiespanel.block" ng-change="propertiespanel.update()"
                    class="no-border">
                </b3-key-table>
            </div>

            <div class="form-group" ng-if="propertiespanel.original.name == 'Explanation Method'">
                <b3-key-table-Expl heading="Properties EXP" ng-model="propertiespanel.block.propertyExpl"
                    class="no-border">
                </b3-key-table-Expl>
            </div>

            <div class="form-group" ng-show="propertiespanel.original.category == 'composite'">
                <button id="ButtonSubMore" type="button" ng-click="propertiespanel.FormSubstitute()"> More like this
                    but...?</button>
                <button id="ButtonSubMore" type="button"
                    ng-click="propertiespanel.SubstituteNodes(propertiespanel.original)">More like this?</button>
            </div>

            <div class="form-group" ng-if="propertiespanel.original.category == 'root'">
                <div class="DivModel">
                    <label>Model</label>
                    <button ng-click="propertiespanel.GetModelsPublic()">Load Public Models</button>
                </div>

                <div class="form-group">
                    <div id="header">
                        <ul class="nav">
                            <li>
                                <a ng-model="propertiespanel.Models"
                                    ng-init="propertiespanel.loadModel()">{{propertiespanel.modelsSelect}}</a>
                                <ul>
                                    <li ng-repeat="Model in propertiespanel.models"
                                        ng-click="propertiespanel.SelectModel(Model)">
                                        <a
                                            ng-class="{'first-model': Model ===  propertiespanel.models[propertiespanel.idModelUrl] }">{{Model}}</a>
                                    </li>
                                </ul>
                            </li>

                        </ul>
                    </div>
                </div>

                <b3-Proper-Params id="b3-Proper-Params" heading="Params EXP" ng-model="propertiespanel.block.ModelRoot"
                    ng-change="propertiespanel.update()" class="no-border">
                </b3-Proper-Params>
            </div>

            <div class="form-group" ng-if="propertiespanel.original.name == 'Explanation Method'">
                <thead>
                    <tr>
                        <th colspan="3">
                            <label class="control-label">PARAMS</label>
                        </th>
                    </tr>
                </thead>
            </div>

            <div class="form-group" ng-if="propertiespanel.original.name == 'Explanation Method'">
                <table class="keytable">
                    <tbody>
                        <tr ng-repeat="item in propertiespanel.ArrayParams">
                            <td class="keyPropertiesTdParams" ng-if="item.type != 'checkbox'">
                                <input id="ParamsKey" type="text" class="form-control" value="{{item.key}}"
                                    ng-disabled="item.fixed" ng-model="item.key" readonly="readonly"
                                    data-tooltip="{{propertiespanel.datatooltipParam}}"
                                    ng-mouseover="propertiespanel.GetInfoParam(item.key)" />
                            </td>
                            <td ng-if="item.type != 'checkbox'" class="keyPropertiesValue">
                                <!--Input number-->
                                <input ng-if="item.type == 'number'" type="{{item.type}}" class="form-control"
                                    value="{{item.value}}" ng-model="item.value"
                                    data-tooltip="{{'Min '+item.range[0]+' Max '+item.range[1] }}"
                                    ng-change="propertiespanel.change()" />
                                <!--Input text-->
                                <input ng-if="item.type == 'text'" type="{{item.type}}" class="form-control"
                                    value="{{item.value}}" ng-model="item.value" ng-change="propertiespanel.change()" />
                                <!--Input select-->
                                <select ng-if="item.type == 'select'" class="form-control" style="padding: 0;"
                                    name="transporte" ng-model="item.value" ng-options="option for option in item.range"
                                    ng-change="propertiespanel.change()">
                                </select>
                            </td>

                        </tr>
                    </tbody>
                </table>
                <table class="keytable" id="CheckboxTable">
                    <tbody>
                        <tr ng-repeat="item in propertiespanel.ArrayParams">
                            <!--Input Checkbox -->
                            <td class="TdCheckBox" ng-if="item.type =='checkbox'">
                                <accordion id="accordion">
                                    <accordion-group>
                                        <accordion-heading>
                                            <p class="Textaccordion-heading"
                                                data-tooltip="{{propertiespanel.datatooltipParam}}"
                                                ng-mouseover="propertiespanel.GetInfoParam(item.key)">
                                                ▼ {{item.key}}
                                            </p>

                                        </accordion-heading>
                                        <div ng-repeat="data in item.range">
                                            <input type="checkbox" class="pull-left glyphicon"
                                                ng-click="propertiespanel.filterSubitemClick(data, item.key, $event)"
                                                ng-checked="item.default.indexOf(data) !== -1"
                                                value="{{data}}" />{{data}}
                                        </div>
                                    </accordion-group>
                                </accordion>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="form-group" ng-if="propertiespanel.original.name == 'User Question'">
                <table class="table table-condensed keytable" ng-repeat="item in propertiespanel.ArrayParams">

                    <tr ng-repeat="item in propertiespanel.ArrayParams" class="keyPropertiesTdParams">
                        <td>
                            <input id="ParamsKey" type="text" class="form-control" value="{{item.key}}"
                                ng-disabled="item.fixed" ng-model="item.key" readonly="readonly" />
                        </td>
                    </tr>
                    <tr ng-repeat="item in propertiespanel.ArrayParams" style="margin-top: 50px;">
                        <td>
                            <input type="text" class="form-control" value="{{item.value}}" ng-model="item.value"
                                ng-change="propertiespanel.change()" />
                        </td>
                    </tr>
                </table>
            </div>

            <div class="form-group" ng-if="propertiespanel.original.name == 'Explanation Method'">
                <button id="ButtonRun" type="button"
                    ng-click="propertiespanel.RunNew(propertiespanel.original.id,propertiespanel.block)">Run</button>
            </div>

            <div id="loader" style="display: none;">
                <div class="load">
                    <hr />
                    <hr />
                    <hr />
                    <hr />
                </div>
            </div>


            <div ng-if="propertiespanel.original.name == 'Explanation Method'">
                <div id="TextAreaEpl" class="form-group"
                    ng-if="propertiespanel.original.Json.type == 'dict'|| propertiespanel.original.Json.type == 'text'">
                    <textarea id="TextArea" name="description" rows="4" class="form-control"
                        ng-model="propertiespanel.block.Json.explanation" readonly>
                    </textarea>
                </div>
                <div id="DivImg" class="form-group" ng-if="propertiespanel.original.Image != undefined"
                    ng-init="propertiespanel.LoadImagen()">
                    <img id="ImgExpl" src="" ng-click="propertiespanel.PopUpImg(propertiespanel.original.Image)">
                </div>
                <div id="mi-div" class="form-group" style="overflow-x:auto; overflow-y:auto;"
                    ng-init="propertiespanel.LoadHtmlCode()"
                    ng-click="propertiespanel.PopUpHtml(propertiespanel.block.Json)">

                </div>

            </div>



            <div ng-if="propertiespanel.original.name == 'Explanation Method'">
                <div id="header" ng-if="propertiespanel.TitleName">
                    <ul class="nav">
                        <li ng-if="propertiespanel.original.category != 'root'">
                            <a ng-model="propertiespanel.block.title"
                                ng-click="propertiespanel._SearchSubstituteExplainers(propertiespanel.block.title)">Search
                                substitute explainers</a>
                            <ul ng-if="propertiespanel.original.name == 'Explanation Method'">
                                <!-- Mostrar "Cargando" mientras se obtienen los datos -->
                                <li ng-if="propertiespanel.isLoading">
                                    <div class="progress" ng-if="!isEmpty(propertiespanel.ExplainersSubstitute)">
                                        <div>
                                            <p class="progress-bar-text truncate-text">Loading, please wait...</p>
                                        </div>
                                    </div>
                                </li>
                                <!-- Mostrar la lista una vez que los datos estén disponibles -->
                                <li ng-if="!propertiespanel.isLoading"
                                    ng-repeat="item in propertiespanel.ExplainersSubstitute" g-disabled="item.fixed"
                                    ng-model="item.key" readonly="readonly"
                                    ng-click="propertiespanel.UpdateProperties(item.explainer, propertiespanel.block, propertiespanel.original.id)"
                                    ng-mouseenter="propertiespanel.startTimeout(item,'substitute')"
                                    ng-mouseleave="propertiespanel.cancelTimeout(item,'substitute')">
                                    <div class="progress" ng-if="!isEmpty(propertiespanel.ExplainersSubstitute)">
                                        <div class="progress-bar" ng-style="{ 'width': (item.similarity * 100) + '%' }">
                                        </div>
                                        <div>
                                            <p class="progress-bar-text truncate-text">{{(item.similarity *
                                                100).toFixed(0)}}% {{item.explainer}}</p>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="form-group" ng-if="propertiespanel.original.name == 'Explanation Method'">
                <button id="ButtonSubMore" type="button" ng-click="propertiespanel.FormSubstitute()">More like
                    this?</button>
            </div>


            <div id="myModal" class="modal">
                <div id="contenedor" class="p-8 bg-light border">
                    <img id="modal-img" class="modal-content">
                    <span id="closeImg" class="close" style="color: red;"
                        ng-click="propertiespanel.PopUpImgClose()">&times;</span>
                </div>

                <div id="caption"></div>
            </div>

            <div id="myModal1" class="modal" style="margin-top: 40%; ">
                <div id="contenedor-html" class="p-8 bg-light border" style="overflow-x:auto; overflow-y:auto;">
                </div>
                <div>
                    <span id="closeImg1" class="close" style="color: red;"
                        ng-click="propertiespanel.PopUpImgClose()">&times;</span>
                </div>

                <div id="caption"></div>
            </div>

            <div id="SubstituteNodesview" class="modal">
                <div id="contenedor-help" style="margin-left: 10%;text-align: left;" class="p-8 bg-light border">

                    <canvas id="myCanvas" width="1500" height="1500" tabindex="0"
                        style="background-color: rgb(23, 23, 23); outline: none;" b3-drop-node="true">

                    </canvas>
                    <div id="modal-content-help" style="width: 100%;padding: 10px;" class="modal-content">

                        <img id="ImagenCanvas" src="" alt="">

                    </div>
                    <span id="closeFormButton" style="color: #000;" class="close">&times;</span>
                </div>
            </div>

            <!-- form  Explainer requirements-->
            <div id="formSubstitute" class="modal">
                <div id="contenedor-help" style="margin-left: 10%;text-align: left;" class="p-8 bg-light border">
                    <div id="modal-content-help" style="width: 100%;padding: 10px;" class="modal-content">
                        <h1 id="iseee3-user-help">Explainer requirements</h1>

                        <table class="keytable">
                            <tbody>
                                <tr ng-repeat="item in propertiespanel.ArrayParams">

                                    <form action="">
                                        <div ng-show="propertiespanel.original.category == 'composite'">
                                            <h4 class="titleSubForm">
                                                Explainer</h4>
                                            <accordion>
                                                <accordion-group is-pen="propertiespanel.explainerAccordionOpen">
                                                    <accordion-heading>
                                                        <span class="placeholder-text"
                                                            ng-show="propertiespanel.ExplainersSubSelect == 0"
                                                            class="placeholder-text">
                                                            Select Explainer
                                                        </span>
                                                        <span ng-show="propertiespanel.ExplainersSubSelect != 0"
                                                            class="selected-formats">
                                                            <span
                                                                ng-repeat="item in propertiespanel.ExplainersSubSelect">
                                                                {{item.name}}{{$last ? '' : ', '}} </span>
                                                        </span>

                                                    </accordion-heading>
                                                    <div class="checkbox-tree">
                                                        <ul class="ulSelect">
                                                            <li class="LiSelect"
                                                                ng-repeat="item in propertiespanel.ExplainersSub">
                                                                <div class="DivCheckboxFormSub">
                                                                    <label>
                                                                        <input type="checkbox" ng-model="item.checked"
                                                                            ng-change="propertiespanel.toggleItemSelection('Explainer',item)">
                                                                        {{item.name}}
                                                                    </label>
                                                                </div>
                                                    </div>
                                                </accordion-group>
                                            </accordion>
                                        </div>
                                        <!-- ok -->
                                        <h4 class="titleSubForm"> Explanation Scope</h4>
                                        <accordion>
                                            <accordion-group>
                                                <accordion-heading>
                                                    <span class="placeholder-text"
                                                        ng-show="propertiespanel.ExplanationScopeSubSelect.length == 0"
                                                        class="placeholder-text">
                                                        Explanation Scope
                                                    </span>
                                                    <span
                                                        ng-show="propertiespanel.ExplanationScopeSubSelect.length != 0"
                                                        class="selected-formats">
                                                        <span
                                                            ng-repeat="item in propertiespanel.ExplanationScopeSubSelect">
                                                            {{item.label}}{{$last ? '' : ', '}} </span>
                                                    </span>

                                                </accordion-heading>
                                                <div class="checkbox-tree"
                                                    ng-show="propertiespanel.original.title ==  'Explanation Method'">
                                                    <span>Unselect explainer</span>
                                                </div>
                                                <div class="checkbox-tree"
                                                    ng-show="propertiespanel.original.title != 'Explanation Method'">
                                                    <ul class="ulSelect">
                                                        <li class="LiSelect"
                                                            ng-repeat="item in propertiespanel.ExplanationScopeSub">
                                                            <div class="DivCheckboxFormSub">
                                                                <label>
                                                                    <input type="checkbox" ng-model="item.checked"
                                                                        ng-change="propertiespanel.toggleItemSelection('Explanation Scope',item)">
                                                                    {{item.label}}
                                                                </label>
                                                            </div>
                                                </div>
                                            </accordion-group>
                                        </accordion>


                                        <h4 class="titleSubForm">
                                            Explanation Type</h4>

                                        <accordion>
                                            <accordion-group>
                                                <accordion-heading>
                                                    <span class="placeholder-text"
                                                        ng-show="propertiespanel.ExplanationTypeSubSelect.length == 0"
                                                        class="placeholder-text">
                                                        Pick or Search Explainability Type
                                                    </span>
                                                    <span ng-show="propertiespanel.ExplanationTypeSubSelect.length != 0"
                                                        class="selected-formats">
                                                        <span
                                                            ng-repeat="item in propertiespanel.ExplanationTypeSubSelect">
                                                            {{
                                                            item.label }}{{$last ? '' : ', '}} </span>
                                                    </span>


                                                </accordion-heading>
                                                <div class="checkbox-tree"
                                                    ng-show="propertiespanel.original.title ==  'Explanation Method'">
                                                    <span>Unselect explainer</span>
                                                </div>
                                                <div class="checkbox-tree"
                                                    ng-show="propertiespanel.original.title != 'Explanation Method'">
                                                    <ul>
                                                        <li ng-repeat="item in propertiespanel.ExplanationTypeSub">
                                                            <div class="DivCheckboxFormSub">
                                                                <i class="fas fa" ng-if="item.children.length > 0"
                                                                    class="fas"
                                                                    ng-class="{'fa-caret-down': item.expanded && propertiespanel.hasChildren(item) && item.checked, 'fa-caret-right': !item.expanded || !propertiespanel.hasChildren(item) || !item.checked}"
                                                                    ng-click="propertiespanel.toggleItem(item, $event)"></i>

                                                                <label>
                                                                    <input type="checkbox" ng-model="item.checked"
                                                                        ng-change="propertiespanel.toggleItemSelection( 'Explanation Type',item)"
                                                                        ng-click="$event.stopPropagation()">
                                                                    {{item.label}}
                                                                </label>
                                                            </div>

                                                            <ul
                                                                ng-show="item.expanded && propertiespanel.hasChildren(item)">
                                                                <li ng-repeat="childItem in item.children">
                                                                    <div class="DivCheckboxFormSub">
                                                                        <i class="fas fa"
                                                                            ng-if="childItem.children.length > 0"
                                                                            class="fas"
                                                                            ng-class="{'fa-caret-down': childItem.expanded && propertiespanel.hasChildren(childItem) && childItem.checked, 'fa-caret-right': !childItem.expanded || !propertiespanel.hasChildren(childItem) || !childItem.checked}"
                                                                            ng-click="propertiespanel.toggleItem(childItem, $event)"></i>

                                                                        <label>
                                                                            <input type="checkbox"
                                                                                ng-model="childItem.checked"
                                                                                ng-change="propertiespanel.toggleItemSelection( 'Explanation Type' ,childItem)">
                                                                            {{childItem.label}}
                                                                        </label>
                                                                    </div>
                                                                </li>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </accordion-group>
                                        </accordion>

                                        <div ng-show="divExpanded || propertiespanel.original.category != 'composite'">

                                            <h4 class="titleSubForm">
                                                Explainability Technique</h4>
                                            <accordion>
                                                <accordion-group>
                                                    <accordion-heading>
                                                        <span class="placeholder-text"
                                                            ng-show="propertiespanel.ExplainabilityTechniqueSubSelect.length == 0"
                                                            class="placeholder-text">
                                                            Pick or Search Explainability Technique
                                                        </span>
                                                        <span
                                                            ng-show="propertiespanel.ExplainabilityTechniqueSubSelect.length != 0"
                                                            class="selected-formats">
                                                            <span
                                                                ng-repeat="item in propertiespanel.ExplainabilityTechniqueSubSelect">
                                                                {{
                                                                item.label }}{{$last ? '' : ', '}} </span>
                                                        </span>


                                                    </accordion-heading>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title ==  'Explanation Method'">
                                                        <span>Unselect explainer</span>
                                                    </div>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title != 'Explanation Method'">
                                                        <ul>
                                                            <li
                                                                ng-repeat="item in propertiespanel.ExplainabilityTechniqueSub">
                                                                <div class="DivCheckboxFormSub">
                                                                    <i class="fas fa" ng-if="item.children.length > 0"
                                                                        class="fas"
                                                                        ng-class="{'fa-caret-down': item.expanded && propertiespanel.hasChildren(item) && item.checked, 'fa-caret-right': !item.expanded || !propertiespanel.hasChildren(item) || !item.checked}"
                                                                        ng-click="propertiespanel.toggleItem(item, $event)"></i>

                                                                    <label>
                                                                        <input type="checkbox" ng-model="item.checked"
                                                                            ng-change="propertiespanel.toggleItemSelection( 'Explainability Technique',item)"
                                                                            ng-click="$event.stopPropagation()">
                                                                        {{item.label}}
                                                                    </label>
                                                                </div>

                                                                <ul
                                                                    ng-show="item.expanded && propertiespanel.hasChildren(item)">
                                                                    <li ng-repeat="childItem in item.children">
                                                                        <div class="DivCheckboxFormSub">
                                                                            <i class="fas fa"
                                                                                ng-if="childItem.children.length > 0"
                                                                                class="fas"
                                                                                ng-class="{'fa-caret-down': childItem.expanded && propertiespanel.hasChildren(childItem) && childItem.checked, 'fa-caret-right': !childItem.expanded || !propertiespanel.hasChildren(childItem) || !childItem.checked}"
                                                                                ng-click="propertiespanel.toggleItem(childItem, $event)"></i>

                                                                            <label>
                                                                                <input type="checkbox"
                                                                                    ng-model="childItem.checked"
                                                                                    ng-change="propertiespanel.toggleItemSelection( 'Explainability Technique' ,childItem)">
                                                                                {{childItem.label}}
                                                                            </label>
                                                                        </div>
                                                                        <ul
                                                                            ng-show="childItem.expanded && propertiespanel.hasChildren(childItem)">
                                                                            <li
                                                                                ng-repeat="grandchildItem in childItem.children">
                                                                                <div class="DivCheckboxFormSub">
                                                                                    <i class="fas fa"
                                                                                        ng-if="grandchildItem.children.length > 0"
                                                                                        class="fas"
                                                                                        ng-class="{'fa-caret-down': grandchildItem.expanded && propertiespanel.hasChildren(grandchildItem) && grandchildItem.checked, 'fa-caret-right': !grandchildItem.expanded || !propertiespanel.hasChildren(grandchildItem) || !grandchildItem.checked}"
                                                                                        ng-click="propertiespanel.toggleItem(grandchildItem, $event)"></i>

                                                                                    <label>
                                                                                        <input type="checkbox"
                                                                                            ng-model="grandchildItem.checked"
                                                                                            ng-change="propertiespanel.toggleItemSelection('Explainability Technique',grandchildItem)">
                                                                                        {{grandchildItem.label}}
                                                                                    </label>
                                                                                </div>
                                                                            </li>
                                                                        </ul>
                                                                    </li>
                                                                </ul>
                                                    </div>
                                                </accordion-group>
                                            </accordion>


                                            <h4 class="titleSubForm">
                                                Presentation format</h4>
                                            <accordion>
                                                <accordion-group>
                                                    <accordion-heading>
                                                        <span class="placeholder-text"
                                                            ng-show="propertiespanel.PresentationFormatSubSelect.length == 0"
                                                            class="placeholder-text">
                                                            Pick or Search Explainability Technique
                                                        </span>
                                                        <span
                                                            ng-show="propertiespanel.PresentationFormatSubSelect.length != 0"
                                                            class="selected-formats">
                                                            <span
                                                                ng-repeat="item in propertiespanel.PresentationFormatSubSelect">
                                                                {{
                                                                item.label }}{{$last ? '' : ', '}} </span>
                                                        </span>


                                                    </accordion-heading>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title ==  'Explanation Method'">
                                                        <span>Unselect explainer</span>
                                                    </div>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title != 'Explanation Method'">
                                                        <ul>
                                                            <li
                                                                ng-repeat="item in propertiespanel.PresentationformatSub">
                                                                <div class="DivCheckboxFormSub">
                                                                    <i class="fas fa" ng-if="item.children.length > 0"
                                                                        class="fas"
                                                                        ng-class="{'fa-caret-down': item.expanded && propertiespanel.hasChildren(item) && item.checked, 'fa-caret-right': !item.expanded || !propertiespanel.hasChildren(item) || !item.checked}"
                                                                        ng-click="propertiespanel.toggleItem(item, $event)"></i>

                                                                    <label>
                                                                        <input type="checkbox" ng-model="item.checked"
                                                                            ng-change="propertiespanel.toggleItemSelection( 'Presentation format',item)"
                                                                            ng-click="$event.stopPropagation()">
                                                                        {{item.label}}
                                                                    </label>
                                                                </div>

                                                                <ul
                                                                    ng-show="item.expanded && propertiespanel.hasChildren(item)">
                                                                    <li ng-repeat="childItem in item.children">
                                                                        <div class="DivCheckboxFormSub">
                                                                            <i class="fas fa"
                                                                                ng-if="childItem.children.length > 0"
                                                                                class="fas"
                                                                                ng-class="{'fa-caret-down': childItem.expanded && propertiespanel.hasChildren(childItem) && childItem.checked, 'fa-caret-right': !childItem.expanded || !propertiespanel.hasChildren(childItem) || !childItem.checked}"
                                                                                ng-click="propertiespanel.toggleItem(childItem, $event)"></i>

                                                                            <label>
                                                                                <input type="checkbox"
                                                                                    ng-model="childItem.checked"
                                                                                    ng-change="propertiespanel.toggleItemSelection( 'Presentation format' ,childItem)">
                                                                                {{childItem.label}}
                                                                            </label>
                                                                        </div>
                                                                        <ul
                                                                            ng-show="childItem.expanded && propertiespanel.hasChildren(childItem)">
                                                                            <li
                                                                                ng-repeat="grandchildItem in childItem.children">
                                                                                <div class="DivCheckboxFormSub">
                                                                                    <i class="fas fa"
                                                                                        ng-if="grandchildItem.children.length > 0"
                                                                                        class="fas"
                                                                                        ng-class="{'fa-caret-down': grandchildItem.expanded && propertiespanel.hasChildren(grandchildItem) && grandchildItem.checked, 'fa-caret-right': !grandchildItem.expanded || !propertiespanel.hasChildren(grandchildItem) || !grandchildItem.checked}"
                                                                                        ng-click="propertiespanel.toggleItem(grandchildItem, $event)"></i>

                                                                                    <label>
                                                                                        <input type="checkbox"
                                                                                            ng-model="grandchildItem.checked"
                                                                                            ng-change="propertiespanel.toggleItemSelection( 'Presentation format',grandchildItem)">
                                                                                        {{grandchildItem.label}}
                                                                                    </label>
                                                                                </div>
                                                                                <ul
                                                                                    ng-show="grandchildItem.expanded && propertiespanel.hasChildren(grandchildItem)">
                                                                                    <li
                                                                                        ng-repeat="grandchildItem1 in grandchildItem.children">
                                                                                        <div class="DivCheckboxFormSub">
                                                                                            <i class="fas fa"
                                                                                                ng-if="grandchildItem1.children.length > 0"
                                                                                                class="fas"
                                                                                                ng-class="{'fa-caret-down': grandchildItem1.expanded && propertiespanel.hasChildren(grandchildItem1) && grandchildItem.checked, 'fa-caret-right': !grandchildItem.expanded || !propertiespanel.hasChildren(grandchildItem) || !grandchildItem.checked}"
                                                                                                ng-click="propertiespanel.toggleItem(grandchildItem1, $event)"></i>

                                                                                            <label>
                                                                                                <input type="checkbox"
                                                                                                    ng-model="grandchildItem1.checked"
                                                                                                    ng-change="propertiespanel.toggleItemSelection( 'Presentation format',grandchildItem1)">
                                                                                                {{grandchildItem1.label}}
                                                                                            </label>
                                                                                        </div>
                                                                                    </li>
                                                                                </ul>
                                                                            </li>
                                                                        </ul>
                                                                    </li>
                                                                </ul>
                                                    </div>
                                                </accordion-group>
                                            </accordion>


                                            <!-- ok -->
                                            <h4 class="titleSubForm">
                                                Computational Complexity</h4>
                                            <accordion>
                                                <accordion-group
                                                    is-pen="propertiespanel.ComputationalComplexityAccordionOpen">
                                                    <accordion-heading>
                                                        <span class="placeholder-text"
                                                            ng-show="propertiespanel.ComputationalComplexitySubSelect.length == 0"
                                                            class="placeholder-text">
                                                            Computational Complexity
                                                        </span>
                                                        <span
                                                            ng-show="propertiespanel.ComputationalComplexitySubSelect.length != 0"
                                                            class="selected-formats">
                                                            <span
                                                                ng-repeat="item in propertiespanel.ComputationalComplexitySubSelect">
                                                                {{item.label}}{{$last ? '' : ', '}} </span>
                                                        </span>

                                                    </accordion-heading>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title ==  'Explanation Method'">
                                                        <span>Unselect explainer</span>
                                                    </div>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title != 'Explanation Method'">
                                                        <ul class="ulSelect">
                                                            <li class="LiSelect"
                                                                ng-repeat="item in propertiespanel.ComputationalComplexitySub">
                                                                <div class="DivCheckboxFormSub">
                                                                    <label>
                                                                        <input type="checkbox" ng-model="item.checked"
                                                                            ng-change="propertiespanel.toggleItemSelection('Computational Complexity',item)">
                                                                        {{item.label}}
                                                                    </label>
                                                                </div>
                                                    </div>
                                                </accordion-group>
                                            </accordion>

                                            <!-- ok -->
                                            <h4 class="titleSubForm">
                                                Implementation Framework</h4>
                                            <accordion>
                                                <accordion-group>
                                                    <accordion-heading>
                                                        <span class="placeholder-text"
                                                            ng-show="propertiespanel.ImplementationFrameworkSubSelect.length == 0"
                                                            class="placeholder-text">
                                                            Implementation Framework
                                                        </span>
                                                        <span
                                                            ng-show="propertiespanel.ImplementationFrameworkSubSelect.length != 0"
                                                            class="selected-formats">
                                                            <span
                                                                ng-repeat="item in propertiespanel.ImplementationFrameworkSubSelect">
                                                                {{item.label}}{{$last ? '' : ', '}} </span>
                                                        </span>

                                                    </accordion-heading>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title ==  'Explanation Method'">
                                                        <span>Unselect explainer</span>
                                                    </div>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title != 'Explanation Method'">
                                                        <ul class="ulSelect">
                                                            <li class="LiSelect"
                                                                ng-repeat="item in propertiespanel.ImplementationFrameworkSub">
                                                                <div class="DivCheckboxFormSub">
                                                                    <label>
                                                                        <input type="checkbox" ng-model="item.checked"
                                                                            ng-change="propertiespanel.toggleItemSelection('Implementation Framework',item)">
                                                                        {{item.label}}
                                                                    </label>
                                                                </div>
                                                    </div>
                                                </accordion-group>
                                            </accordion>

                                            <!-- ok -->
                                            <h4 class="titleSubForm">
                                                Explainer Concurrentnes</h4>
                                            <accordion>
                                                <accordion-group
                                                    is-pen="propertiespanel.ExplainerConcurrentnessAccordionOpen">
                                                    <accordion-heading>
                                                        <span class="placeholder-text"
                                                            ng-show="propertiespanel.ExplainerConcurrentnessSubSelect.length == 0"
                                                            class="placeholder-text">
                                                            Explainer Concurrentnes
                                                        </span>
                                                        <span
                                                            ng-show="propertiespanel.ExplainerConcurrentnessSubSelect.length != 0"
                                                            class="selected-formats">
                                                            <span
                                                                ng-repeat="item in propertiespanel.ExplainerConcurrentnessSubSelect">
                                                                {{item.label}}{{$last ? '' : ', '}} </span>
                                                        </span>

                                                    </accordion-heading>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title ==  'Explanation Method'">
                                                        <span>Unselect explainer</span>
                                                    </div>
                                                    <div class="checkbox-tree"
                                                        ng-show="propertiespanel.original.title != 'Explanation Method'">
                                                        <ul class="ulSelect">
                                                            <li class="LiSelect"
                                                                ng-repeat="item in propertiespanel.ExplainerConcurrentnessSub">
                                                                <div class="DivCheckboxFormSub">
                                                                    <label>
                                                                        <input type="checkbox" ng-model="item.checked"
                                                                            ng-change="propertiespanel.toggleItemSelection('Explainer Concurrentnes',item)">
                                                                        {{item.label}}
                                                                    </label>
                                                                </div>
                                                    </div>
                                                </accordion-group>
                                            </accordion>

                                        </div>

                                        <div id="buttonContainer">
                                            <button class="advanced-properties-button"
                                                ng-show="propertiespanel.original.category == 'composite'"
                                                ng-click=" propertiespanel.expandAdvancedPropertis()">Advanced
                                                properties</button>
                                            <button type="button"
                                                ng-click="propertiespanel.submitFormSub(propertiespanel.original)">Accept</button>
                                        </div>
                                        <div class="button-container-right">

                                        </div>
                                    </form>
                                </tr>
                            </tbody>
                        </table>

                        <span id="closeFormButton" style="color: #000;" class="close"
                            ng-click="propertiespanel.closeForm();">&times;</span>
                    </div>
                    <div id="caption"></div>
                </div>
            </div>

            <div id="videoModal" class="modal">
                <div id="contenedor-video" style="margin-left: 10%;text-align: left;" class="p-8 bg-light border">
                    <div id="video-modal-content" style="width: 100%;padding: 10px;" class="modal-content">
                        <h1>Video Tutorial</h1>
                        <video id="videoTutorial" width="100%" controls volume="1">
                            <source src="imgs/tutorial.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <span id="closeVideoButton" style="color: #000;" class="close">&times;</span>
                    </div>
                    <div id="caption"></div>
                </div>
            </div>

            <div id="helpModal" class="modal">
                <div id="contenedor-help" style="margin-left: 10%;text-align: left;" class="p-8 bg-light border">
                    <div id="modal-content-help" style="width: 100%;padding: 10px;" class="modal-content">
                        <h1 id="iseee3-user-help">iSeeE3 User Help</h1>
                        <h2 id="creating-your-first-project">Creating your first project</h2>
                        When opening the editor for the first time, there will be a default
                        project title “Project 1” that you can access straight away. You can
                        rename the project or simply create a new one by clicking on the “New
                        Explanation Experience” button. Then click on the “Editor” button to
                        start building your own explanation experiences.
                        <p style="text-align: center;">
                            <img width="100%" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207810403-43b26356-25b4-44de-b6c4-518f3201e58e.png">
                        </p>
                        <h2 id="first-look-at-the-interface">First Look at the Interface</h2>
                        iSeeE3 is a tool based on behavior trees that allows you to build and
                        customize your own explanation experiences. For an empty explanation
                        experience, the interface will look like this:
                        <p style="text-align: center;">
                            <img width="100%" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207819838-2a3e9c65-d439-4577-8efe-dcdbf722a44d.png">
                        </p>
                        <p>At first glance, the interface might be overwhelming, so we cover
                            each of its components next:</p>
                        <h3 id="main-panel">Main Panel</h3>
                        <p>The main panel is where we can visualize our tree and interact with
                            it by clicking on its components and dragging and dropping new nodes.
                            For a newly created project, the main panel will only contain the root
                            node of the default tree that is created. We will see how to interact
                            with the panel in the next sections.</p>
                        <h3 id="menu-bar">Menu Bar</h3>
                        <p style="text-align: center;">
                            <img width="100%" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207816324-3c59dbba-a747-41bd-8155-89b2d2a2398e.png">
                        </p>
                        <p>The menu bar allows you to quickly save the project and access the
                            tool settings, undo and redo changes, and the following submenus:</p>
                        <ul>
                            <li><strong>Project:</strong> to save the project, import, and export a
                                project, tree, or node as JSON, access the editor settings and create
                                new explanation experiences and custom nodes.</li>
                            <li><strong>Edit:</strong> provides access to basic edition
                                functionalities, such as undo and redo actions, copy, cut, paste, and
                                remove selected nodes.<br />
                            </li>
                            <li><strong>View:</strong> For zooming in and zooming out, as well as
                                organizing the nodes of a tree for a cleaner presentation.</li>
                            <li><strong>Selection</strong>: to select or deselect a node, select a
                                subtree or invert the current selection.</li>
                            <li><strong>Random Generator:</strong> to randomly generate explanation
                                experiences by specifying certain parameters, such as the minimum number
                                of nodes and the depth of the trees to be created.</li>
                            <li><strong>Help:</strong> provides access to this guide and a video
                                tutorial.</li>
                        </ul>
                        <h3 id="trees-and-nodes-panel">Trees and Nodes Panel</h3>
                        <p style="text-align: center;">
                            <img width="349" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207820894-e5be21fe-e740-4013-8523-d3efd338c1db.png">
                        </p>
                        <p>On the left side of the interface, we have the trees and nodes panel.
                            The <strong>“Trees”</strong> section displays all the trees contained in
                            the current project, highlighting the currently selected tree in blue.
                            We can create new trees by hovering over the panel title and clicking on
                            the “New” button. To remove any of the trees, simply hover over its name
                            and click on “Remove”.</p>
                        <p>The <strong>“Nodes”</strong> section contains all the nodes that can
                            be appended to the current tree. You can use different types of
                            nodes:</p>
                        <ul>
                            <li><strong>Explanation Method:</strong> A generic explanation method
                                node. The explanation method that will be used is specified from the
                                <em>Properties</em> panel, as well as the execution parameters that may
                                be needed.
                                <p style="text-align: center;">
                                    <img width="290" alt="image"
                                        src="https://user-images.githubusercontent.com/71895708/207826990-f26ea539-9e01-49de-8aa7-33d77c3bfa07.png">
                                </p>
                            </li>
                            <li><strong>Failer and Succeeder:</strong> return failure or success
                                accordingly.
                                <p style="text-align: center;">
                                    <img width="545" alt="image"
                                        src="https://user-images.githubusercontent.com/71895708/207826544-323b8977-f1ca-4613-8180-e4a81e30c6ba.png">
                                </p>
                            </li>
                            <li><strong>Condition:</strong> This node can be used to check for
                                external variables to meet a particular condition (equals, not equals,
                                less than, greater than)
                                <p style="text-align: center;">
                                    <img width="268" alt="image"
                                        src="https://user-images.githubusercontent.com/71895708/207827039-0bf5c5fb-cd6b-448c-85d9-3b2287cc2184.png">
                                </p>
                            </li>
                            <li><strong>Sequence and Priority:</strong> These are considered
                                composite nodes. They act as connectors and indicate the execution flow
                                of many nodes. A sequence node will return immediately upon one of its
                                children failing. A priority node will return immediately upon one of
                                its children succeeding.
                                <p style="text-align: center;">
                                    <img width="217" alt="image"
                                        src="https://user-images.githubusercontent.com/71895708/207827132-b3950731-ce3f-493e-8c1f-53ece28ea42f.png">
                                </p>
                            </li>
                            <li><strong>Decorator Nodes:</strong> these are additional nodes that
                                aim to define the execution flow at a higher level. It is possible to
                                use the “Repeat” nodes to represent loops in our behavior trees. The
                                “Inverter” node simply inverts the returned value of another node
                                (failure/success)</li>
                        </ul>
                        <p style="text-align: center;">
                            <img width="100%" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207829559-b802d64f-400d-4df6-8610-af19f95af080.png">
                        </p>
                        <h3 id="properties-panel">Properties Panel</h3>
                        <p>The <em>Properties</em> panel allows defining and modifying the
                            individual properties of a node. The view of this panel may change
                            depending on the node that is selected. The root node is a special case,
                            as it represents the whole tree, and its properties will persist on the
                            entire tree object.</p>
                        <p>The <em>Properties</em> panel of the <strong>root node</strong> looks
                            like this:</p>
                        <p style="text-align: center;">
                            <img width="293" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207836434-11a66c43-a497-4765-8b77-014a0f62dfb3.png">
                        </p>
                        <ul>
                            <li><strong>Run BT button:</strong> executes the entire behavior
                                tree.</li>
                            <li><strong>Intent:</strong> it allows renaming the current explanation
                                experience.</li>
                            <li><strong>Description and Properties:</strong> a description for this
                                tree can be added in the provided text field. Additional properties can
                                be added as key-value pairs by clicking on the “+” button.</li>
                            <li><strong>Model:</strong> a dropdown menu with the names of the models
                                that were uploaded to the iSee database. You can select the model you
                                want to explain or see how to <em>include your own</em>. To execute a
                                behavior tree, a model must be selected.</li>
                            <li><strong>Query:</strong> If you wish to include local explanation
                                methods, a query (data instance) must be given. This query can be
                                provided as plain text selecting the tabular data type, or as a file,
                                which is exclusive for image queries. Please keep in mind the input
                                format expected by the model when providing an image file as a query. If
                                the model you selected requires preprocessing of the image (i.e requires
                                a different encoding from RGB for the input), then provide the query as
                                plain text containing the matrix with the pixel values.</li>
                            <li><strong>Save:</strong> Saves the specified query (if any). If a new
                                query is provided afterward, then it will overwrite the previous
                                one.</li>
                        </ul>
                        <p>Most nodes have properties like title, description, and user-defined
                            properties:</p>
                        <p style="text-align: center;">
                            <img width="289" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207841650-5e4b068c-cbd8-4f42-88cd-5cdb6bbc7ea7.png">
                        </p>
                        <p>However, explanation method nodes are initially generic, waiting for
                            a specific method to be selected. Hovering over the title of this node
                            will display a drop-down menu that allows you the select the explanation
                            method that you want. After selecting the desired method, the
                            <em>Properties</em> panel will be updated, changing the name of the node
                            and including the execution parameters (Params section) that are unique
                            to that explanation method:
                        </p>
                        <p style="text-align: center;">
                            <img width="292" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207842600-c108605d-bb77-4fba-b436-0121cece8347.png">
                        </p>
                        <p>Hovering over the names of the parameters, you can get information
                            about what is the expected input format and their effect on the
                            generated explanation. If parameters are left blank, default values will
                            be given so execution is not affected. However, there are methods that
                            may exceptionally require a parameter to be specified by the user, so it
                            is encouraged to check the documentation for each specific
                            parameter.</p>
                        <p>Finally, the <em>Properties</em> panel for explanation method nodes
                            includes a “Run” button, that will execute this explanation method,
                            given that you have specified a model and query if required, and that
                            the node is attached to the behavior tree.</p>
                        <h2 id="building-and-executing-explanation-experiences">Building and
                            Executing Explanation Experiences:</h2>
                        <p>The process for building and executing explanation experiences can be
                            summarized in the following steps:</p>
                        <ol type="1">
                            <li><strong>Open an existing project or create your own.</strong></li>
                            <li><strong>Select an existing explanation experience from the
                                    <em>Trees</em> section or create a new one.</strong></li>
                            <li><strong>Select the root node and define its
                                    properties.</strong></li>
                            <li><strong>Select the model that will be used for explanations and
                                    provide a query if needed. Remember to save the query.</strong></li>
                        </ol>
                        <p style="text-align: center;">
                            <img width="557" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207846884-0d6da57e-890f-47cc-81a3-a13402093058.png">
                        </p>
                        <ol start="5" type="1">
                            <li><strong>Drag and drop the desired nodes from the <em>Nodes</em>
                                    section to build your explanation experience. In this example, we build
                                    a simple tree that ensures that at least one global and one local
                                    explanation is provided to the user:</strong></li>
                        </ol>
                        <p style="text-align: center;">
                            <img width="100%" alt="image"
                                src="https://user-images.githubusercontent.com/71895708/207848462-66f4c4d8-fc5f-4760-b75f-19d98e2af927.png">
                        </p>
                        <ol start="6" type="1">
                            <li><strong>Specify execution parameters for the explanation methods (if
                                    necessary).</strong></li>
                            <li><strong>Execute the behavior tree or each individual
                                    method.</strong></li>
                        </ol>

                        <span id="closehelpButton" style="color: #000;" class="close">&times;</span>

                    </div>
                    <div id="caption"></div>
                </div>
            </div>
        </form>
    </div>

</div>